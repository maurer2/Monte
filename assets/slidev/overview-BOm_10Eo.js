import{d as te,e as ne,_ as oe,f as le}from"../modules/unplugin-icons-DKGwFFba.js";import{d as J,ab as ae,ac as ie,t as H,ad as se,E as U,D as ce,a4 as re,n as Q,B as r,o as a,c as k,i as S,h as W,ae as ue,af as de,b as _,j as me,N as pe,z as L,O as fe,K as ve,e as c,F as j,ag as q,k as M,x,g as I,l as y}from"../modules/vue-Dxc2MuZf.js";import{u as he,a as ge,s as ke,c as _e,C as X,i as be,b as V,t as xe,g as G,p as ye}from"../index-2pPdbWY-.js";import{_ as we,C as Ce}from"./NoteDisplay.vue_vue_type_style_index_0_lang-BljmxUZr.js";import{u as De,S as $e,_ as Fe,a as Se}from"./SlideWrapper-DbGZiLBb.js";import{_ as K}from"./IconButton.vue_vue_type_script_setup_true_lang-Bxu1dYj3.js";import"../modules/shiki-BSihjmjQ.js";const Ee=["placeholder"],Me=J({__name:"NoteEditable",props:{no:{type:Number,required:!0},class:{default:""},editing:{default:!1},style:{default:()=>({})},placeholder:{default:"No notes for this slide"},clicksContext:{type:Object},highlight:{default:!0},autoHeight:{default:!1}},emits:["update:editing","markerDblclick","markerClick"],setup(w,{emit:N}){const l=w,u=ae(l,"editing",N,{passive:!0}),{info:C,update:h}=De(ie(l,"no")),m=H("");let E;const{ignoreUpdates:z}=se(m,i=>{if(!u.value)return;const p=l.no;clearTimeout(E),E=setTimeout(()=>{h({note:i},p)},500)});U(()=>{var i;return(i=C.value)==null?void 0:i.note},(i="")=>{u.value||(clearTimeout(E),z(()=>{m.value=i}))},{immediate:!0,flush:"sync"});const s=H(),D=H();ce(()=>{var i;u.value&&((i=s.value)==null||i.focus())}),re(s,()=>{u.value=!1});function b(){!l.autoHeight||!s.value||!u.value||s.value.scrollHeight>s.value.clientHeight&&(s.value.style.height=`${s.value.scrollHeight}px`)}function B(i){u.value&&i.metaKey&&i.key==="s"&&(i.preventDefault(),h({note:m.value},l.no))}return U([m,u],()=>{Q(()=>{b()})},{flush:"post",immediate:!0}),(i,p)=>{var T;return r(u)?ue((a(),_("textarea",{key:1,ref_key:"inputEl",ref:s,"onUpdate:modelValue":p[2]||(p[2]=g=>m.value=g),class:S(["prose resize-none overflow-auto outline-none bg-transparent block border-primary border-2",l.class]),style:W([{"line-height":"1.75"},[l.style,D.value!=null?{height:`${D.value}px`}:{}]]),placeholder:w.placeholder,onKeydown:[p[3]||(p[3]=me(g=>u.value=!1,["esc"])),B]},null,46,Ee)),[[de,m.value]]):(a(),k(we,{key:0,class:S(["border-transparent border-2",[l.class,m.value?"":"opacity-25 italic select-none"]]),style:W(l.style),note:m.value||w.placeholder,"note-html":(T=r(C))==null?void 0:T.noteHTML,"clicks-context":w.clicksContext,"auto-scroll":!w.autoHeight,highlight:l.highlight,onMarkerClick:p[0]||(p[0]=(g,$)=>N("markerClick",g,$)),onMarkerDblclick:p[1]||(p[1]=(g,$)=>N("markerDblclick",g,$))},null,8,["class","style","note","note-html","clicks-context","auto-scroll","highlight"]))}}}),He={class:"h-screen w-screen of-hidden flex"},Ne={class:"grid grid-rows-[auto_max-content] border-r border-main select-none max-h-full h-full"},Be={class:"relative"},Te={class:"absolute left-0 top-0 bottom-0 w-200 flex flex-col flex-auto items-end group p2 gap-1 max-h-full of-x-visible of-y-auto",style:{direction:"rtl"}},Ae=["onClick"],Ie={p2:"",border:"t main"},Ve={class:"select-none w-13 text-right my4 flex flex-col gap-1 items-end"},Ke={class:"text-3xl op20 mb2"},We=["onDblclick"],ze={class:"py3 mt-0.5 mr--8 ml--4 op0 transition group-hover:op100"},Le={key:0,class:"select-none absolute bottom-0 right-0 bg-main rounded-tl p2 op35 text-xs"},Oe={class:"absolute top-0 right-0 px3 py1.5 border-b border-l rounded-lb bg-main border-main select-none"},Re={class:"text-xs op50"},O=450,Ye=J({__name:"overview",setup(w){he({title:`Overview - ${ke}`});const{openInEditor:N,slides:l}=ge(),u=pe(new Map),C=H([]),h=H(null),m=L(()=>l.value.map(t=>{var e,o;return p(((o=(e=t.meta)==null?void 0:e.slide)==null?void 0:o.note)||"")})),E=L(()=>m.value.reduce((t,e)=>t+e,0)),z=L(()=>l.value.map(t=>B(t)).reduce((t,e)=>t+e,0)),s=fe(),D=new WeakMap;function b(t){return D.has(t)||D.set(t,_e(t,X)),D.get(t)}function B(t){var e,o;return((e=t.meta)==null?void 0:e.clicks)||((o=b(t))==null?void 0:o.total)}function i(t){s.value===t?s.value=void 0:s.value=t}function p(t){const e=/[\w`'\-\u0392-\u03C9\u00C0-\u00FF\u0600-\u06FF\u0400-\u04FF]+|[\u4E00-\u9FFF\u3400-\u4DBF\uF900-\uFAFF\u3040-\u309F\uAC00-\uD7AF]+/g,o=t.match(e);let f=0;if(!o)return 0;for(let F=0;F<o.length;F++)o[F].charCodeAt(0)>=19968?f+=o[F].length:f+=1;return f}function T(t){const e=t.getBoundingClientRect(),o=20;return e.top>=0-o&&e.left>=0-o&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)+o&&e.right<=(window.innerWidth||document.documentElement.clientWidth)+o}function g(){const t=[];Array.from(u.entries()).forEach(([e,o])=>{T(o)&&t.push(e)}),C.value=t}function $(t){const e=document.createElement("a");e.target="_blank",e.href=ye+t.slice(1),e.click()}function Y(t){const e=u.get(t);e&&e.scrollIntoView({behavior:"smooth",block:"start"})}function Z(t,e,o){const f=b(o);f.current===e?f.current=X:f.current=e,t.preventDefault()}return ve(()=>{Q(()=>{g()})}),(t,e)=>{const o=te,f=ne,F=oe,ee=le;return a(),_("div",He,[c("nav",Ne,[c("div",Be,[c("div",Te,[(a(!0),_(j,null,q(r(l),(n,v)=>{var d,A,R,P;return a(),_("div",{key:n.no,class:"relative",style:{direction:"ltr"}},[c("button",{class:S(["relative transition duration-300 w-8 h-8 rounded hover:bg-active hover:op100",C.value.includes(v)?"op100 text-primary bg-gray:5":"op20"]),onClick:Pe=>Y(v)},[c("div",null,x(v+1),1)],10,Ae),(A=(d=n.meta)==null?void 0:d.slide)!=null&&A.title?(a(),_("div",{key:0,class:S(["pointer-events-none select-none absolute left-110% backdrop-blur-8 top-50% translate-y--50% ws-nowrap z-10 px2 shadow-xl rounded border border-main transition duration-400 op0 group-hover:op100",C.value.includes(v)?"text-primary":"text-main important-text-op-50"])},x((P=(R=n.meta)==null?void 0:R.slide)==null?void 0:P.title),3)):I("",!0)])}),128))])]),c("div",Ie,[r(be)?(a(),k(K,{key:1,title:r(V)?"Dark mode":"Light mode","pointer-events-none":"",op50:""},{default:M(()=>[r(V)?(a(),k(o,{key:0})):(a(),k(f,{key:1}))]),_:1},8,["title"])):(a(),k(K,{key:0,title:r(V)?"Switch to light mode theme":"Switch to dark mode theme",onClick:e[0]||(e[0]=n=>r(xe)())},{default:M(()=>[r(V)?(a(),k(o,{key:0})):(a(),k(f,{key:1}))]),_:1},8,["title"]))])]),c("main",{class:"flex-1 h-full of-auto",style:W(`grid-template-columns: repeat(auto-fit,minmax(${O}px,1fr))`),onScroll:g},[(a(!0),_(j,null,q(r(l),(n,v)=>(a(),_("div",{key:n.no,ref_for:!0,ref:d=>u.set(v,d),class:S(["relative border-t border-main of-hidden flex gap-4 min-h-50 group",v===0?"pt5":""])},[c("div",Ve,[c("div",Ke,x(v+1),1),y(K,{class:"mr--3 op0 group-hover:op80",title:"Play in new tab",onClick:d=>$(r(G)(n,!1))},{default:M(()=>[y(F)]),_:2},1032,["onClick"]),I("",!0)]),c("div",{class:"flex flex-col gap-2 my5",style:W({width:`${O}px`})},[c("div",{class:"border rounded border-main overflow-hidden bg-main select-none h-max",onDblclick:d=>$(r(G)(n,!1))},[(a(),k(Se,{key:n.no,width:O,class:"pointer-events-none important:[&_*]:select-none"},{default:M(()=>[y($e,{"clicks-context":b(n),route:n,"render-context":"overview"},null,8,["clicks-context","route"]),y(Fe,{page:n.no},null,8,["page"])]),_:2},1024))],40,We),B(n)?(a(),k(Ce,{key:0,active:s.value===n,"clicks-context":b(n),class:"w-full mt-2",onDblclick:d=>i(n),onClick:d=>s.value=n},null,8,["active","clicks-context","onDblclick","onClick"])):I("",!0)],4),c("div",ze,[y(K,{title:"Edit Note",class:S(["rounded-full w-9 h-9 text-sm",h.value===n.no?"important:op0":""]),onClick:d=>h.value=n.no},{default:M(()=>[y(ee)]),_:2},1032,["class","onClick"])]),y(Me,{no:n.no,class:"max-w-250 w-250 text-lg rounded p3","auto-height":!0,highlight:s.value===n,editing:h.value===n.no,"clicks-context":b(n),onDblclick:d=>h.value!==n.no?h.value=n.no:null,"onUpdate:editing":e[1]||(e[1]=d=>h.value=null),onMarkerClick:(d,A)=>Z(d,A,n)},null,8,["no","highlight","editing","clicks-context","onDblclick","onMarkerClick"]),m.value[v]>0?(a(),_("div",Le,x(m.value[v])+" words ",1)):I("",!0)],2))),128))],36),c("div",Oe,[c("div",Re,x(r(l).length)+" slides · "+x(z.value+r(l).length-1)+" clicks · "+x(E.value)+" words ",1)])])}}});export{Ye as default};
